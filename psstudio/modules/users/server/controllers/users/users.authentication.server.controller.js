var a9_0x33ad=["json","signin","authenticate","login","signout","oauthCall","session","query","oauthCallback","redirect_to","redirect","/authentication/signin?err=","getErrorMessage","user","providerData.","providerIdentifierField","additionalProvidersData.","providerData","findOne","username","email","profileImageURL","additionalProvidersData","markModified","/settings/accounts","removeOAuthProvider","path","./modules/core/server/controllers/errors.server.controller","mongoose","passport","resolve","./config/config","model","User","/authentication/signin","userLimit","count","error","Unable\x20to\x20get\x20count\x20of\x20users","license","signup","status","send","body","roles","provider","local","displayName","firstName","lastName","save","password","salt"];(function(_0xc5d40e,_0x20aac0){var _0x2bffd=function(_0x51b13a){while(--_0x51b13a){_0xc5d40e["push"](_0xc5d40e["shift"]());}};_0x2bffd(++_0x20aac0);}(a9_0x33ad,0x123));var a9_0x33a2=function(_0x266852,_0x33d011){_0x266852=_0x266852-0x0;var _0x115c08=a9_0x33ad[_0x266852];return _0x115c08;};"use strict";/**
 * Module dependencies.
 */var path=require(a9_0x33a2("0x0")),errorHandler=require(path["resolve"](a9_0x33a2("0x1"))),mongoose=require(a9_0x33a2("0x2")),passport=require(a9_0x33a2("0x3")),config=require(path[a9_0x33a2("0x4")](a9_0x33a2("0x5"))),User=mongoose[a9_0x33a2("0x6")](a9_0x33a2("0x7"));var noReturnUrls=[a9_0x33a2("0x8"),"/authentication/signup"];function checkUserLimit(_0x404886){if(!config["license"][a9_0x33a2("0x9")]){return _0x404886(!![]);}User[a9_0x33a2("0xa")]()["exec"](function(_0x402b1d,_0x353e68){if(_0x402b1d){logger[a9_0x33a2("0xb")](a9_0x33a2("0xc"),{"error":_0x402b1d});return _0x404886(![]);}else{return _0x404886(_0x353e68>=config[a9_0x33a2("0xd")][a9_0x33a2("0x9")]);}});}exports[a9_0x33a2("0xe")]=function(_0x2a9d23,_0x5ed53e){checkUserLimit(function(_0x2f33ae){if(_0x2f33ae){return _0x5ed53e[a9_0x33a2("0xf")](0x190)[a9_0x33a2("0x10")]({"message":"User\x20limit\x20reached!"});}else{delete _0x2a9d23[a9_0x33a2("0x11")][a9_0x33a2("0x12")];var _0x36bd4f=new User(_0x2a9d23[a9_0x33a2("0x11")]);var _0xa6a16b=null;_0x36bd4f[a9_0x33a2("0x13")]=a9_0x33a2("0x14");_0x36bd4f[a9_0x33a2("0x15")]=_0x36bd4f[a9_0x33a2("0x16")]+"\x20"+_0x36bd4f[a9_0x33a2("0x17")];_0x36bd4f[a9_0x33a2("0x18")](function(_0x3461e2){if(_0x3461e2){return _0x5ed53e[a9_0x33a2("0xf")](0x190)[a9_0x33a2("0x10")]({"message":errorHandler["getErrorMessage"](_0x3461e2)});}else{_0x36bd4f[a9_0x33a2("0x19")]=undefined;_0x36bd4f[a9_0x33a2("0x1a")]=undefined;_0x5ed53e[a9_0x33a2("0x1b")](_0x36bd4f);}});}});};exports[a9_0x33a2("0x1c")]=function(_0x4e1e36,_0x1eb4ad,_0x1622b7){passport[a9_0x33a2("0x1d")](a9_0x33a2("0x14"),function(_0x2071ca,_0x13924f,_0x5823ee){if(_0x2071ca||!_0x13924f){_0x1eb4ad[a9_0x33a2("0xf")](0x190)[a9_0x33a2("0x10")](_0x5823ee);}else{_0x13924f[a9_0x33a2("0x19")]=undefined;_0x13924f[a9_0x33a2("0x1a")]=undefined;_0x4e1e36[a9_0x33a2("0x1e")](_0x13924f,function(_0x2071ca){if(_0x2071ca){_0x1eb4ad[a9_0x33a2("0xf")](0x190)[a9_0x33a2("0x10")](_0x2071ca);}else{_0x1eb4ad["json"](_0x13924f);}});}})(_0x4e1e36,_0x1eb4ad,_0x1622b7);};exports[a9_0x33a2("0x1f")]=function(_0x60093d,_0xe69f64){_0x60093d["logout"]();_0xe69f64["redirect"]("/");};exports[a9_0x33a2("0x20")]=function(_0x57342f,_0x2ba771){return function(_0x1adbc5,_0x32f458,_0x510312){if(noReturnUrls["indexOf"](_0x1adbc5["query"]["redirect_to"])===-0x1){_0x1adbc5[a9_0x33a2("0x21")]["redirect_to"]=_0x1adbc5[a9_0x33a2("0x22")]["redirect_to"];}passport[a9_0x33a2("0x1d")](_0x57342f,_0x2ba771)(_0x1adbc5,_0x32f458,_0x510312);};};exports[a9_0x33a2("0x23")]=function(_0x332cdd){return function(_0x13863a,_0x9301ec,_0x3586cb){var _0x14d0ac=_0x13863a[a9_0x33a2("0x21")]["redirect_to"];delete _0x13863a["session"][a9_0x33a2("0x24")];passport[a9_0x33a2("0x1d")](_0x332cdd,function(_0x14d33e,_0x2c7d24,_0x58e94a){if(_0x14d33e){return _0x9301ec[a9_0x33a2("0x25")](a9_0x33a2("0x26")+encodeURIComponent(errorHandler[a9_0x33a2("0x27")](_0x14d33e)));}if(!_0x2c7d24){return _0x9301ec[a9_0x33a2("0x25")](a9_0x33a2("0x8"));}_0x13863a[a9_0x33a2("0x1e")](_0x2c7d24,function(_0x14d33e){if(_0x14d33e){return _0x9301ec["redirect"]("/authentication/signin");}return _0x9301ec[a9_0x33a2("0x25")](_0x58e94a||_0x14d0ac||"/");});})(_0x13863a,_0x9301ec,_0x3586cb);};};exports["saveOAuthUserProfile"]=function(_0x385121,_0x3e2981,_0x13fdf3){if(!_0x385121[a9_0x33a2("0x28")]){var _0x188bc9=a9_0x33a2("0x29")+_0x3e2981[a9_0x33a2("0x2a")];var _0x3910c4=a9_0x33a2("0x2b")+_0x3e2981["provider"]+"."+_0x3e2981["providerIdentifierField"];var _0x468eb3={};_0x468eb3[a9_0x33a2("0x13")]=_0x3e2981[a9_0x33a2("0x13")];_0x468eb3[_0x188bc9]=_0x3e2981[a9_0x33a2("0x2c")][_0x3e2981[a9_0x33a2("0x2a")]];var _0x26cf6c={};_0x26cf6c[_0x3910c4]=_0x3e2981[a9_0x33a2("0x2c")][_0x3e2981[a9_0x33a2("0x2a")]];var _0x1b6829={"$or":[_0x468eb3,_0x26cf6c]};User[a9_0x33a2("0x2d")](_0x1b6829,function(_0x36c351,_0x39d51f){if(_0x36c351){return _0x13fdf3(_0x36c351);}else{if(!_0x39d51f){var _0x485e7b=_0x3e2981[a9_0x33a2("0x2e")]||(_0x3e2981[a9_0x33a2("0x2f")]?_0x3e2981["email"]["split"]("@")[0x0]:"");User["findUniqueUsername"](_0x485e7b,null,function(_0x5451f1){_0x39d51f=new User({"firstName":_0x3e2981[a9_0x33a2("0x16")],"lastName":_0x3e2981[a9_0x33a2("0x17")],"username":_0x5451f1,"displayName":_0x3e2981[a9_0x33a2("0x15")],"email":_0x3e2981[a9_0x33a2("0x2f")],"profileImageURL":_0x3e2981[a9_0x33a2("0x30")],"provider":_0x3e2981[a9_0x33a2("0x13")],"providerData":_0x3e2981["providerData"]});_0x39d51f[a9_0x33a2("0x18")](function(_0x36c351){return _0x13fdf3(_0x36c351,_0x39d51f);});});}else{return _0x13fdf3(_0x36c351,_0x39d51f);}}});}else{var _0x3ad98e=_0x385121[a9_0x33a2("0x28")];if(_0x3ad98e[a9_0x33a2("0x13")]!==_0x3e2981["provider"]&&(!_0x3ad98e["additionalProvidersData"]||!_0x3ad98e[a9_0x33a2("0x31")][_0x3e2981[a9_0x33a2("0x13")]])){if(!_0x3ad98e[a9_0x33a2("0x31")]){_0x3ad98e[a9_0x33a2("0x31")]={};}_0x3ad98e[a9_0x33a2("0x31")][_0x3e2981["provider"]]=_0x3e2981[a9_0x33a2("0x2c")];_0x3ad98e[a9_0x33a2("0x32")](a9_0x33a2("0x31"));_0x3ad98e[a9_0x33a2("0x18")](function(_0x549a4c){return _0x13fdf3(_0x549a4c,_0x3ad98e,a9_0x33a2("0x33"));});}else{return _0x13fdf3(new Error("User\x20is\x20already\x20connected\x20using\x20this\x20provider"),_0x3ad98e);}}};exports[a9_0x33a2("0x34")]=function(_0x3f4a2a,_0x480d1a,_0x88c06a){var _0x4c6ecf=_0x3f4a2a[a9_0x33a2("0x28")];var _0x16afb9=_0x3f4a2a[a9_0x33a2("0x22")][a9_0x33a2("0x13")];if(!_0x4c6ecf){return _0x480d1a[a9_0x33a2("0xf")](0x191)["json"]({"message":"User\x20is\x20not\x20authenticated"});}else if(!_0x16afb9){return _0x480d1a[a9_0x33a2("0xf")](0x190)[a9_0x33a2("0x10")]();}if(_0x4c6ecf["additionalProvidersData"][_0x16afb9]){delete _0x4c6ecf[a9_0x33a2("0x31")][_0x16afb9];_0x4c6ecf[a9_0x33a2("0x32")]("additionalProvidersData");}_0x4c6ecf[a9_0x33a2("0x18")](function(_0x528cea){if(_0x528cea){return _0x480d1a[a9_0x33a2("0xf")](0x190)[a9_0x33a2("0x10")]({"message":errorHandler[a9_0x33a2("0x27")](_0x528cea)});}else{_0x3f4a2a[a9_0x33a2("0x1e")](_0x4c6ecf,function(_0x528cea){if(_0x528cea){return _0x480d1a["status"](0x190)[a9_0x33a2("0x10")](_0x528cea);}else{return _0x480d1a[a9_0x33a2("0x1b")](_0x4c6ecf);}});}});};